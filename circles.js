import{h as t,T as e,r as i,e as s,n as r}from"./property-87bb8bd7.js";class c{constructor(t){this.currentPosition=0,(this.host=t).addController(this),this.circleOperations=[]}addCircle(t,e,i){this.circleOperations.splice(this.currentPosition,0,{action:"add",circleData:{diameter:t,id:`${Date.now().toString()}-${Math.floor(1e6*Math.random())}`,x:e,y:i}}),this.currentPosition++,this.host.requestUpdate()}changeCircle(t,e,i,s){this.circleOperations.splice(this.currentPosition,0,{action:"change",circleData:{diameter:t,id:e,x:i,y:s}}),this.currentPosition++,this.host.requestUpdate()}undo(){0!=this.currentPosition&&(this.currentPosition--,this.host.requestUpdate())}redo(){this.currentPosition!=this.circleOperations.length&&(this.currentPosition++,this.host.requestUpdate())}get currentCircles(){const t=new Map;return this.circleOperations.forEach(((e,i)=>{if(!(i>=this.currentPosition)){if("add"==e.action){if(!e.circleData)return void console.error(`Added circle with no data at ${i}`);t.set(e.circleData.id,e.circleData)}if(0!=i&&"change"==e.action){if(!e.circleData)return void console.error(`Changed circle with no data at ${i}`);t.set(e.circleData.id,e.circleData)}}})),t}hostConnected(){this.host.requestUpdate()}hostDisconnected(){this.host.requestUpdate()}}var n=function(t,e,i,s){var r,c=arguments.length,n=c<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(n=(c<3?r(n):c>3?r(e,i,n):r(e,i))||n);return c>3&&n&&Object.defineProperty(e,i,n),n};let l=class extends t{constructor(){super(),this.dialog=document.createElement("dialog"),this.circleId=""}_clickAdjustDiameter(t){if(!t||!t.target)return;const e={diameter:t.target.value};this.dispatchEvent(new CustomEvent("adjustDiameter",{detail:e,bubbles:!0,composed:!0}))}render(){return e`<div><label for="diameter">Adjusting diameter for ${this.circleId}</label> <input type="range" id="diameter" name="diameter" min="0" max="300" @input="${this._clickAdjustDiameter}"></div>`}};l.styles=i``,n([s({type:String})],l.prototype,"circleId",void 0),l=n([r("seven-gui-circles-adjust-diameter")],l);let o=class extends t{constructor(){super(),this.circleId="",this.showingSubmenu=!0,this.circleAdjustment=new l,this.circleAdjustment.circleId=this.circleId}_clickAdjustDiameter(){this.showingSubmenu=!1,this.requestUpdate()}render(){return e`${this.showingSubmenu?e`<div><button @click="${this._clickAdjustDiameter}">Adjust Diameter</button></div>`:e`<seven-gui-circles-adjust-diameter></seven-gui-circles-adjust-diameter>`}`}};o.styles=i`dialog{padding:0;border:none}`,n([s({type:String})],o.prototype,"circleId",void 0),o=n([r("seven-gui-circles-popup")],o);let a=class extends t{constructor(){super(),this.circleController=new c(this),this._latestMouseX=0,this._latestMouseY=0,this.canvas=document.createElement("canvas"),this.canvas.addEventListener("click",this._clickCanvas.bind(this)),this.canvas.addEventListener("mousemove",this.mouseEvent.bind(this)),this.addEventListener("adjustDiameter",this._changeDiameter.bind(this)),this.showingMenu=!1,this.popupMenu=new o,this.circleController.addCircle(50,10,10),this.circleController.addCircle(200,50,50),this.circleController.addCircle(20,200,50)}_clickUndo(){this.circleController.undo()}_clickRedo(){this.circleController.redo()}_changeDiameter(t){console.log(t.detail),this.circleAdjusting&&(this.circleAdjusting.diameter=t.detail.diameter),this.requestUpdate()}_startCircleMenu(t){this.circleAdjusting=t,this.showingMenu=!0,this.requestUpdate()}_stopCircleMenu(){this.showingMenu=!1,this.circleAdjusting&&this.circleController.changeCircle(this.circleAdjusting.diameter,this.circleAdjusting.id,this.circleAdjusting.x,this.circleAdjusting.y),this.circleAdjusting=void 0}_clickCanvas(t){let e=null;for(const[,i]of this.circleController.currentCircles.entries()){Math.sqrt(Math.pow(t.offsetX-i.x,2)+Math.pow(t.offsetY-i.y,2))<i.diameter/2&&(console.log(`Inside circle ${i.id}`),e=i)}if(1==this.showingMenu)this._stopCircleMenu();else if(0==this.showingMenu&&null!=e)this.popupMenu.circleId=e.id,this._startCircleMenu({...e});else if(null==e)return void this.circleController.addCircle(50,t.offsetX,t.offsetY);this.requestUpdate()}mouseEvent(t){this._latestMouseX=t.offsetX,this._latestMouseY=t.offsetY,this.requestUpdate()}willUpdate(){const t=this.canvas.getContext("2d");if(!t)return;t.fillStyle="black",t.clearRect(0,0,this.canvas.width,this.canvas.height);let e=null,i=-1;for(const[,s]of this.circleController.currentCircles.entries()){if(this.circleAdjusting&&s.id==this.circleAdjusting.id)break;const r=Math.sqrt(Math.pow(this._latestMouseX-s.x,2)+Math.pow(this._latestMouseY-s.y,2));r<s.diameter/2&&(-1==i||r<i)&&(e=s,i=r);const c=new Path2D;c.arc(s.x,s.y,s.diameter/2,0,2*Math.PI),t.stroke(c)}if(this.circleAdjusting){t.fillStyle="lightgrey";const e=new Path2D;e.arc(this.circleAdjusting.x,this.circleAdjusting.y,this.circleAdjusting.diameter/2,0,2*Math.PI),t.fill(e),t.fillStyle="black",t.stroke(e)}if(e){t.fillStyle="lightgrey";const i=new Path2D;i.arc(e.x,e.y,e.diameter/2,0,2*Math.PI),t.fill(i)}}render(){return e`<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css"><div class="box"><button class="button" @click="${this._clickUndo}">Undo</button> <button class="button" @click="${this._clickRedo}">Redo</button> ${this.showingMenu?this.popupMenu:""} ${this.canvas}</div>`}};a.styles=i`canvas{display:block;border:solid 1px gray}`,a=n([r("seven-gui-circles")],a);export{l as AdjustDiameter,a as Circle,o as PopupMenu};
